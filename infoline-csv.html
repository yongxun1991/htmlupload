<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infoline CSV Converter</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        label { display: block; margin-top: 10px; }
        input, select, textarea { width: 100%; padding: 5px; margin-top: 5px; }
        button { margin-top: 20px; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        #output { margin-top: 20px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Infoline CSV Converter</h1>
    <p>Enter the campaign details below. Assumptions: Series ID is required (added field as it's essential for CSV). Cover image URI is left blank. Batch IDs are generated per rules, with running numbers differentiated for same product IDs across multiple cuepoints or countries. Unix timestamps are in UTC. Country is single per row; multiples create separate entries. Question: The batch ID format example includes '/' between regions, but since countries are single per row, I've used single country code per batch IDâ€”clarify if multi-country batch IDs are needed. Timezone offsets are simplified to hours from UTC; select appropriately.</p>

    <form id="converterForm">
        <label for="advertiser">Advertiser:</label>
        <input type="text" id="advertiser" required>

        <label for="campaignName">Campaign Name:</label>
        <input type="text" id="campaignName" required maxlength="50">

        <label for="region">Region (e.g., MENA for backend name):</label>
        <input type="text" id="region" required>

        <label>Series ID:</label>
        <input type="text" id="seriesId" required>

        <label>Campaign Start Date & Time:</label>
        <select id="startYear">
            <option value="2024">2024</option>
            <option value="2025" selected>2025</option>
            <option value="2026">2026</option>
            <option value="2027">2027</option>
            <option value="2028">2028</option>
            <option value="2029">2029</option>
            <option value="2030">2030</option>
        </select>
        <select id="startMonth">
            <option value="1">01</option><option value="2">02</option><option value="3">03</option><option value="4">04</option><option value="5">05</option><option value="6">06</option><option value="7">07</option><option value="8">08</option><option value="9">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option>
        </select>
        <select id="startDay">
            <option value="1">01</option><option value="2">02</option><!-- ... up to 31 -->
            <option value="31">31</option>
        </select>
        <select id="startHour"><option value="0">00</option><!-- ... up to 23 --></select>
        <select id="startMin"><option value="0">00</option><!-- ... up to 59 --></select>
        <select id="startSec"><option value="0">00</option><!-- ... up to 59 --></select>
        <select id="startTimezone">
            <option value="0">UTC+0</option>
            <option value="1">UTC+1</option>
            <option value="2">UTC+2</option>
            <option value="3">UTC+3</option>
            <option value="4">UTC+4</option>
            <option value="5">UTC+5</option>
            <option value="6">UTC+6</option>
            <option value="7">UTC+7</option>
            <option value="8">UTC+8</option>
            <option value="9">UTC+9</option>
            <option value="10">UTC+10</option>
            <option value="11">UTC+11</option>
            <option value="12">UTC+12</option>
            <!-- Add negative if needed, e.g. <option value="-5">UTC-5</option> -->
        </select>

        <label>Campaign End Date & Time:</label>
        <!-- Similar selects for endYear, endMonth, etc. -->

        <label for="cuepoints">Cuepoints (comma-separated, in seconds, e.g., 300,600,900):</label>
        <input type="text" id="cuepoints" required>

        <label for="title">Title (Max 50 characters):</label>
        <input type="text" id="title" required maxlength="50">

        <label for="content">Content Body (Optional, Max 120 characters):</label>
        <input type="text" id="content" maxlength="120">

        <label for="cta">CTA Button (Max 15 characters):</label>
        <input type="text" id="cta" required maxlength="15">

        <label for="landing">Landing Page[](https://...):</label>
        <input type="url" id="landing" required pattern="https://.*">

        <label for="productIds">Selected Product IDs (comma-separated, e.g., 2671541,2671769):</label>
        <input type="text" id="productIds" required>

        <label for="countries">Country Selection (Multiple):</label>
        <select id="countries" multiple required>
            <option value="1819730|HK">Hong Kong (HK)</option>
            <option value="1880251|SG">Singapore (SG)</option>
            <option value="1605651|TH">Thailand (TH)</option>
            <option value="1694008|PH">Philippines (PH)</option>
            <option value="1643084|ID">Indonesia (ID)</option>
            <option value="1733045|MY">Malaysia (MY)</option>
            <option value="286963|OM">Oman (OM)</option>
            <option value="285570|KW">Kuwait (KW)</option>
            <option value="290291|BH">Bahrain (BH)</option>
            <option value="102358|SA">Saudi Arabia (SA)</option>
            <option value="289688|QA">Qatar (QA)</option>
            <option value="69543|YE">Yemen (YE)</option>
            <option value="290557|AE">United Arab Emirates (AE)</option>
            <option value="357994|EG">Egypt (EG)</option>
            <option value="2542007|MA">Morocco (MA)</option>
            <option value="366755|SD">Sudan (SD)</option>
            <option value="2464461|TN">Tunisia (TN)</option>
            <option value="2589581|DZ">Algeria (DZ)</option>
            <option value="99237|IQ">Iraq (IQ)</option>
            <option value="272103|LB">Lebanon (LB)</option>
            <option value="6254930|PS">Palestine (PS)</option>
            <option value="248816|JO">Jordan (JO)</option>
            <option value="1327865|MM">Myanmar (MM)</option>
            <option value="953987|ZA">South Africa (ZA)</option>
        </select>

        <label for="userTypes">User Type (Multiple):</label>
        <select id="userTypes" multiple required>
            <option value="anonymous">Anonymous</option>
            <option value="free">Free</option>
            <option value="premium">Premium</option>
        </select>

        <label for="platforms">Platform (Multiple):</label>
        <select id="platforms" multiple required>
            <option value="web">web</option>
            <option value="pad">pad</option>
            <option value="phone">phone</option>
        </select>

        <label for="duration">Duration (in seconds, max 30):</label>
        <input type="number" id="duration" min="1" max="30" required>

        <button type="button" onclick="generateCSV()">Convert to CSV</button>
    </form>

    <div id="output"></div>

    <script>
        function pad2(num) { return num.toString().padStart(2, '0'); }

        function getUnixTimestamp(year, month, day, hour, min, sec, offset) {
            // offset in hours
            let localHour = parseInt(hour) - parseInt(offset); // Adjust to UTC
            return Date.UTC(year, month - 1, day, localHour, min, sec) / 1000;
        }

        function csvEscape(field) {
            let str = field.toString();
            if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                str = '"' + str.replace(/"/g, '""') + '"';
            }
            return str;
        }

        function generateCSV() {
            // Get values
            const campaignName = document.getElementById('campaignName').value.replace(/\s/g, ''); // Remove spaces as per example
            const region = document.getElementById('region').value;
            const seriesId = document.getElementById('seriesId').value;
            const startYear = document.getElementById('startYear').value;
            const startMonth = document.getElementById('startMonth').value;
            const startDay = document.getElementById('startDay').value;
            const startHour = document.getElementById('startHour').value;
            const startMin = document.getElementById('startMin').value;
            const startSec = document.getElementById('startSec').value;
            const startTimezone = document.getElementById('startTimezone').value;
            // Similar for end...
            // For brevity, assume end vars defined similarly: endYear, etc.
            const yymm = startYear.slice(-2) + pad2(startMonth);
            const backendName = `Infoline_${region}_${campaignName}_${yymm}`;
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const cta = document.getElementById('cta').value;
            const landing = document.getElementById('landing').value;
            const duration = document.getElementById('duration').value;
            const productStr = document.getElementById('productIds').value;
            const cueStr = document.getElementById('cuepoints').value;
            const products = productStr.split(',').map(p => p.trim()).filter(p => p);
            const cues = cueStr.split(',').map(c => c.trim()).filter(c => c);
            const selectedCountries = Array.from(document.getElementById('countries').selectedOptions).map(opt => {
                const [id, code] = opt.value.split('|');
                return {id, code};
            });
            const selectedUserTypes = Array.from(document.getElementById('userTypes').selectedOptions).map(opt => opt.value);
            const anon = selectedUserTypes.includes('anonymous') ? 1 : 0;
            const free = selectedUserTypes.includes('free') ? 1 : 0;
            const prem = selectedUserTypes.includes('premium') ? 1 : 0;
            const selectedPlatforms = Array.from(document.getElementById('platforms').selectedOptions).map(opt => opt.value);
            const startUnix = getUnixTimestamp(startYear, startMonth, startDay, startHour, startMin, startSec, startTimezone);
            const endUnix = getUnixTimestamp(endYear, endMonth, endDay, endHour, endMin, endSec, endTimezone); // Assume end vars

            // Generate combinations
            let combinations = [];
            products.forEach(product => {
                cues.forEach(cue => {
                    selectedCountries.forEach(country => {
                        combinations.push({product, cue, country_id: country.id, country_code: country.code});
                    });
                });
            });

            // Group by product
            let groups = {};
            combinations.forEach(combo => {
                if (!groups[combo.product]) groups[combo.product] = [];
                groups[combo.product].push(combo);
            });

            // Assign running numbers
            for (let product in groups) {
                const group = groups[product];
                if (group.length > 1) {
                    group.forEach((combo, index) => {
                        combo.running_number = pad2(index + 1);
                    });
                } else {
                    group.forEach(combo => {
                        combo.running_number = '01';
                    });
                }
            }

            // Generate rows
            const headers = ['series_id','product_id','batch_id','name','backend_name','cover_image_uri','start_time','time_duration','popup_content','ad_tag','ad_link','ad_auto_show_anonymous_user','ad_auto_show_free_user','ad_auto_show_premium_user','ad_schedule_start_time','ad_schedule_end_time','platform','country_ids'];
            let csvRows = [headers.join(',')];

            combinations.forEach(combo => {
                const batchId = `${combo.country_code.toLowerCase()}${yymm}${combo.running_number}`;
                const row = [
                    seriesId,
                    combo.product,
                    batchId,
                    title,
                    backendName,
                    '', // cover
                    combo.cue,
                    duration,
                    content,
                    cta,
                    landing,
                    anon,
                    free,
                    prem,
                    startUnix,
                    endUnix,
                    JSON.stringify(selectedPlatforms),
                    JSON.stringify([combo.country_id])
                ].map(csvEscape);
                csvRows.push(row.join(','));
            });

            const csvContent = csvRows.join('\n');
            document.getElementById('output').textContent = csvContent;

            // Download
            const blob = new Blob([csvContent], {type: 'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Infoline_${region}_${campaignName}_${yymm}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
